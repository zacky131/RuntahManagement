// untuk menghitung tempat sampah yang ada di tampilan web
var trashbins_count = 0;
// markers array untuk menyimpan seluruh marker
// 
var markers = [];
var map;
function initMap() { // Init Google Map
    map = new google.maps.Map(document.getElementById('map'), {
        zoom: 12,
        center: new google.maps.LatLng(-6.224448, 106.926710),
        mapTypeId: 'terrain'
    });
}
// Untuk menampilkan icon tempat sampah pada googlemap
function AddTrashBin(data) {

    var posisi = { lat: data.val().Latitude, lng: data.val().Longitude };
    var contentString =  "Vol= "+ data.val().FillLevel + "%, " + "Temp= "+ data.val().Temperature + "degC, " + "Hum= "+ data.val().Humidity + "%";
    var serialnumber = "Serial number: " + data.val().SerialNumber
    var color;
    if (data.val().FillLevel<=30){
        color = "#23933f";
    }
    else if (30<data.val().FillLevel<=60){
        color = "#f2ea0c";
    }
    else if (60<data.val().FillLevel<90){
        color = "#c9700a";
    }
    else if (data.val().FillLevel>=90){
        color = "#ea2b04";
    }
        
    var icon = { // Icon tempat sampah, dalam bentuk SVG

        path: "M10.646,5.465L4.061,3.471l9.657-0.16l2.235,4.67l-4.628,0.238L10.646,5.465z M11.722,3.194c0.882,0,1.597-0.715,1.597-1.597S12.604,0,11.722,0s-1.597,0.715-1.597,1.597S10.84,3.194,11.722,3.194z M11.243,8.42l-1.316,9.817l3.432-6.186l1.637,5.985l0.997-9.737L11.243,8.42z M10.191,9.642h-0.39c-0.384,2.705-0.769,5.412-1.155,8.115l-0.038,0.275l-0.273-0.033c-0.659-0.076-1.299-0.113-1.942-0.113c-0.641,0-1.285,0.037-1.942,0.113l-0.274,0.033l-0.039-0.275c-0.384-2.703-0.77-5.41-1.155-8.115H2.595c-0.196,0-0.352-0.198-0.352-0.438c0-0.242,0.157-0.441,0.352-0.441h7.6c0.196,0,0.353,0.199,0.353,0.441C10.549,9.444,10.391,9.641,10.191,9.642z M3.673,10.456c0.314-0.035,0.625-0.063,0.936-0.086c-0.018-0.243-0.034-0.485-0.052-0.729h-1C3.597,9.913,3.636,10.186,3.673,10.456z M3.876,11.85c0.276-0.031,0.557-0.058,0.835-0.076c-0.022-0.279-0.04-0.559-0.061-0.838c-0.297,0.021-0.596,0.049-0.895,0.084C3.793,11.295,3.833,11.573,3.876,11.85z M4.809,13.171c-0.02-0.277-0.039-0.555-0.06-0.83c-0.265,0.019-0.529,0.043-0.795,0.072c0.037,0.275,0.076,0.551,0.116,0.824C4.315,13.21,4.562,13.188,4.809,13.171z M4.267,14.628c0.214-0.024,0.427-0.043,0.64-0.059c-0.021-0.277-0.039-0.555-0.06-0.834c-0.231,0.019-0.464,0.039-0.697,0.064C4.189,14.077,4.227,14.35,4.267,14.628z M4.466,16.018C4.648,16,4.827,15.985,5.007,15.971c-0.021-0.279-0.04-0.559-0.061-0.838c-0.199,0.016-0.399,0.035-0.599,0.055C4.388,15.465,4.426,15.743,4.466,16.018z M5.105,17.366c-0.02-0.275-0.039-0.553-0.059-0.828c-0.166,0.014-0.333,0.027-0.5,0.045c0.04,0.271,0.078,0.549,0.116,0.824C4.811,17.391,4.958,17.377,5.105,17.366z M5.176,10.334c0.312-0.015,0.624-0.025,0.936-0.031c0-0.22,0-0.439-0.001-0.662H5.127C5.143,9.873,5.159,10.102,5.176,10.334z M5.275,11.736c0.279-0.013,0.559-0.021,0.837-0.023c0-0.281,0-0.56,0-0.842c-0.299,0.004-0.597,0.013-0.896,0.027C5.235,11.177,5.255,11.457,5.275,11.736z M5.375,13.133c0.247-0.009,0.493-0.017,0.737-0.021c0-0.277,0-0.557,0-0.832c-0.266,0.002-0.53,0.009-0.797,0.023C5.337,12.58,5.355,12.858,5.375,13.133z M5.473,14.534c0.213-0.012,0.426-0.016,0.639-0.02c0-0.279,0-0.556-0.002-0.834c-0.231,0.002-0.465,0.01-0.696,0.02C5.433,13.979,5.453,14.257,5.473,14.534z M6.112,16.489c-0.166,0.002-0.333,0.008-0.499,0.016c0.02,0.275,0.039,0.553,0.06,0.83c0.145-0.008,0.293-0.01,0.439-0.012C6.112,17.044,6.112,16.766,6.112,16.489z M6.113,15.082c-0.201,0.002-0.399,0.01-0.599,0.018l0.058,0.836c0.182-0.006,0.361-0.012,0.54-0.016C6.112,15.641,6.112,15.362,6.113,15.082z M7.179,16.505c-0.167-0.008-0.332-0.014-0.499-0.016c0,0.277,0,0.555,0,0.834c0.147,0.002,0.293,0.004,0.44,0.012C7.14,17.057,7.159,16.78,7.179,16.505z M7.28,15.1c-0.201-0.008-0.4-0.016-0.6-0.018c0,0.279,0,0.559,0,0.838c0.18,0.004,0.359,0.01,0.539,0.016L7.28,15.1z M7.377,13.7c-0.232-0.01-0.466-0.018-0.698-0.02c0,0.277,0,0.555,0,0.834c0.213,0.004,0.426,0.008,0.64,0.02C7.339,14.256,7.358,13.979,7.377,13.7z M7.477,12.303C7.21,12.29,6.946,12.282,6.681,12.28c0,0.275,0,0.553,0,0.832c0.246,0.003,0.492,0.011,0.738,0.021C7.437,12.858,7.457,12.581,7.477,12.303z M7.575,10.899c-0.299-0.013-0.597-0.023-0.896-0.027v0.842c0.279,0.002,0.558,0.009,0.838,0.023C7.536,11.458,7.556,11.178,7.575,10.899z M7.665,9.642H6.679c0,0.223,0,0.441,0,0.662c0.314,0.006,0.625,0.015,0.937,0.031C7.632,10.102,7.648,9.874,7.665,9.642z M8.248,16.583c-0.167-0.018-0.334-0.031-0.499-0.045c-0.022,0.275-0.04,0.553-0.061,0.828c0.146,0.012,0.294,0.025,0.44,0.041C8.17,17.131,8.208,16.854,8.248,16.583z M8.445,15.188c-0.201-0.02-0.401-0.039-0.6-0.055c-0.02,0.279-0.038,0.559-0.059,0.838c0.18,0.014,0.358,0.029,0.539,0.047C8.365,15.741,8.404,15.465,8.445,15.188z M8.641,13.798c-0.232-0.025-0.466-0.044-0.698-0.064c-0.019,0.279-0.038,0.555-0.058,0.834c0.212,0.016,0.425,0.036,0.638,0.059C8.563,14.35,8.602,14.077,8.641,13.798z M8.842,12.413c-0.268-0.029-0.532-0.052-0.797-0.072c-0.021,0.275-0.038,0.553-0.059,0.83c0.244,0.017,0.489,0.039,0.736,0.066C8.761,12.963,8.8,12.688,8.842,12.413z M9.039,11.02c-0.3-0.035-0.599-0.063-0.896-0.084c-0.021,0.279-0.039,0.559-0.059,0.838c0.276,0.017,0.557,0.045,0.836,0.076C8.959,11.573,8.998,11.295,9.039,11.02z M9.234,9.641H8.233C8.217,9.886,8.2,10.128,8.182,10.37c0.313,0.023,0.623,0.051,0.936,0.086C9.156,10.186,9.194,9.913,9.234,9.641z M8.012,7.661l0.319-1.795H5.977L4.261,4.987L3.982,7.342l1.715,0.481L8.012,7.661z",
        scale: 2,
        fillColor:  color, //<--Warna, anda dapat mengubahnya
        fillOpacity: 1,
        strokeWeight: 1,
        anchor: new google.maps.Point(0, 5),
    };

    var infowindow = new google.maps.InfoWindow({
      content: contentString,
   
    });
    
    var marker = new google.maps.Marker({
        position: posisi,
        icon: icon,
        map: map,
        title: serialnumber
    });
    marker.addListener('click', function() {
        infowindow.open(map, marker);
    });
    markers[data.key] = marker; // memasukan marker dalam bentuk array
 

}
// Referensi database pada firebase
var trashbins_count_Ref = firebase.database().ref('locations');
// Untuk mentrigger jika ada object baru ditambahkan pada database
trashbins_count_Ref.on('child_added', function (data) {
    trashbins_count++;
    AddTrashBin(data);
});
// Untuk mentrigger jika ada perubahan lokasi pada tempat sampah
trashbins_count_Ref.on('child_changed', function (data) {
    markers[data.key].setMap(null);
    AddTrashBin(data);
});
// Jika ada tempat sampah di nonaktifkan, maka marker akan dihilangkan pada maps
trashbins_count_Ref.on('child_removed', function (data) {
    markers[data.key].setMap(null);
    trashbins_count--;
    document.getElementById("trashbins_count").innerHTML = trashbins_count;
});